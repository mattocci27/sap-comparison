---
title: ""
author: "Masatoshi Katabuchi"
date: "`r format(Sys.time(), '%B %d, %Y')`"
fontsize: 12pt
format:
  html:
    theme: coderpro
    toc: true
    toc-depth: 2
    number-sections: true
    smooth-scroll: true
    standalone: true
    embed-resources: true
---

```{r global_options, include=FALSE}
library(knitr)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  cache = FALSE,
  fig.align = "center",
  fig.show = "hold"
)
```

```{r setup, include=FALSE}
library(tidyverse)
library(targets)
```

```{r}
source("R/r2.R")
```

# Species‐level R² for xk (species-level traits)

```{r R2}
s <- tar_read(fit_all_draws_segments_noxylem_traits_sp_simple_all)
s2 <- tar_read(fit_all2_draws_segments_noxylem_traits_sp_simple_all)
s3 <- tar_read(fit_all3_draws_segments_noxylem_traits_sp_simple_all)
stan_data <- tar_read(stan_data_noxylem_all)
stan_data2 <- tar_read(stan_data_noxylem_all2)
stan_data3 <- tar_read(stan_data_noxylem_all3)

r2_sp_all <- compute_species_r2(s, stan_data)
r2_sp_all2 <- compute_species_r2(s2, stan_data2)
r2_sp_all3 <- compute_species_r2(s3, stan_data3)
```

## all: the six traits

- intercept: Co-a
- slope: Co-b

```{r}
r2_sp_all$r2_intercept
r2_sp_all$r2_slope
```

## all2: VAF + Ks

```{r}
r2_sp_all2$r2_intercept
r2_sp_all2$r2_slope
```

## all3: VAF + Ks + Dh
```{r}
r2_sp_all3$r2_intercept
r2_sp_all3$r2_slope
```


# Segment‐level R² for xj (segments-level traits)

- all: the six traits
- all2: VAF + Ks
- all3: VAF + Ks + Dh

```{r}
ss <- tar_read(fit_all_draws_segments_noxylem_traits_simple_all)
ss2 <- tar_read(fit_all2_draws_segments_noxylem_traits_simple_all)
ss3 <- tar_read(fit_all3_draws_segments_noxylem_traits_simple_all)
r2_all <- compute_segment_r2(ss, stan_data)
r2_all2 <- compute_segment_r2(ss2, stan_data2)
r2_all3 <- compute_segment_r2(ss3, stan_data3)

```

## all: the six traits

```{r}
r2_all$r2_intercept
r2_all$r2_slope
```

## all2: VAF + Ks

```{r}
r2_all2$r2_intercept
r2_all2$r2_slope
```

## all3: VAF + Ks + Dh
```{r}
r2_all3$r2_intercept
r2_all3$r2_slope
```

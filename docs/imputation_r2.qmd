---
title: ""
author: "Masatoshi Katabuchi"
date: "`r format(Sys.time(), '%B %d, %Y')`"
fontsize: 12pt
format:
  html:
    theme: coderpro
    toc: true
    toc-depth: 2
    number-sections: true
    smooth-scroll: true
    standalone: true
    embed-resources: true
---

```{r global_options, include=FALSE}
library(knitr)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  cache = FALSE,
  fig.align = "center",
  fig.show = "hold"
)
```

```{r, echo=FALSE}
# renv::install("adletaw/captioner")
# renv::repair()
library(targets)
library(tidyverse)
```


![](`r paste0("file://", here::here("figs/imp_r2.png"))`)

Fig. SX: Observed vs. re-imputed *K*.
The density of overlapping points is reflected by a colour gradient ranging from blue (low point density) to yellow (high point density).
The dashed line represents the 1:1 line.
The solid blue line represents a linear regression.
The correlation is significant (*P* < 0.001).

![](`r paste0("file://", here::here("figs/imp_points2.png"))`)

Fig. SX: An example of *K* value re-imputations for tree ID 11, measured at 2 cm depth from the south direction in February 2015.

```{r, echo=FALSE}
library(lubridate)
d <- withr::with_dir(rprojroot::find_root('_targets.R'),
  targets::tar_read(combined_imputed_k_mapped))

n_all <- nrow(d) |>
  format(big.mark = ",")

n_miss <- d |>
  filter(is.na(k_ori)) |>
  nrow() |>
  format(big.mark = ",")

n_r2 <- d |>
  filter(is.na(k_new_with_na)) |>
  filter(!is.na(k_ori)) |>
  nrow() |>
  format(big.mark = ",")
```


# Method for SI

To assess the accuracy of the imputation, we randomly removed values (*n* = `r n_miss`) from the imputed dataset to create a new dataset with additional missing values, excluding data from September, October, and December 2016 due to their excessive missing values.
This step was necessary because `missForest` does not store imputed values for non-missing entries; it only imputes missing data.
The missing values in this new dataset were then re-imputed.
Finally, we calculated the *R^2^* between the re-imputed values and the original non-missing values (*n* = `r n_r2`).
